name: CI with Web Proxy for Unblocking

on:
  push:
    branches:
      - main
  pull_request:
    branches:
      - main

jobs:
  proxy-job:
    runs-on: ubuntu-latest
    
    steps:
      # Checkout the code
      - name: Checkout code
        uses: actions/checkout@v4

      # Set up the web proxy environment (unblock websites)
      - name: Set up web proxy for unblocking
        run: |
          echo "Setting up web proxy to unblock content..."
          echo "http_proxy=http://<proxy_host>:<proxy_port>" >> $GITHUB_ENV
          echo "https_proxy=http://<proxy_host>:<proxy_port>" >> $GITHUB_ENV
          echo "HTTP_PROXY=http://<proxy_host>:<proxy_port>" >> $GITHUB_ENV
          echo "HTTPS_PROXY=http://<proxy_host>:<proxy_port>" >> $GITHUB_ENV

          # If proxy requires authentication, use the following format
          # echo "http_proxy=http://<proxy_user>:<proxy_password>@<proxy_host>:<proxy_port>" >> $GITHUB_ENV
          # echo "https_proxy=http://<proxy_user>:<proxy_password>@<proxy_host>:<proxy_port>" >> $GITHUB_ENV

      # Test the proxy by accessing a blocked site
      - name: Verify proxy setup by fetching Google (or any unblocked site)
        run: |
          echo "Testing the web proxy setup..."
          curl -I https://www.google.com

      # Example: Set up Node.js and use the proxy to install dependencies (npm, yarn, etc.)
      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '16'

      - name: Install dependencies
        run: |
          npm install

      # Run some network requests using the proxy
      - name: Run script with proxy unblocking
        run: |
          curl -I https://api.github.com # Example: fetching data via the proxy
